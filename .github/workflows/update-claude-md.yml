name: Update CLAUDE.md Reminder

on:
  push:
    branches: [ main ]
    paths:
      - 'src/**/*.py'
      - 'tests/**/*.py'
      - 'pyproject.toml'
      - 'requirements.txt'
      - '.github/workflows/*.yml'
      - 'README.md'

jobs:
  check-documentation:
    name: Check if CLAUDE.md needs update
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2
      
      - name: Check for structural changes
        id: check_changes
        run: |
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ–‡ä»¶æ·»åŠ æˆ–æ–‡ä»¶åˆ é™¤
          ADDED_FILES=$(git diff --name-only --diff-filter=A HEAD~1 HEAD | grep -E '\.(py|yml|yaml|toml)$' || true)
          DELETED_FILES=$(git diff --name-only --diff-filter=D HEAD~1 HEAD | grep -E '\.(py|yml|yaml|toml)$' || true)
          
          if [ -n "$ADDED_FILES" ] || [ -n "$DELETED_FILES" ]; then
            echo "structural_change=true" >> $GITHUB_OUTPUT
            echo "### æ£€æµ‹åˆ°ç»“æ„æ€§å˜åŒ–:" >> $GITHUB_STEP_SUMMARY
            [ -n "$ADDED_FILES" ] && echo "**æ–°å¢æ–‡ä»¶:**" >> $GITHUB_STEP_SUMMARY && echo "$ADDED_FILES" >> $GITHUB_STEP_SUMMARY
            [ -n "$DELETED_FILES" ] && echo "**åˆ é™¤æ–‡ä»¶:**" >> $GITHUB_STEP_SUMMARY && echo "$DELETED_FILES" >> $GITHUB_STEP_SUMMARY
          else
            echo "structural_change=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Create reminder issue
        if: steps.check_changes.outputs.structural_change == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'ğŸ“ æé†’ï¼šCLAUDE.md å¯èƒ½éœ€è¦æ›´æ–°',
              body: 'æ£€æµ‹åˆ°é¡¹ç›®ç»“æ„å˜åŒ–ï¼ˆæ–‡ä»¶æ–°å¢æˆ–åˆ é™¤ï¼‰ï¼Œè¯·æ£€æŸ¥ CLAUDE.md æ˜¯å¦éœ€è¦æ›´æ–°ä»¥åæ˜ æœ€æ–°çš„é¡¹ç›®æ¶æ„å’Œæ¨¡å—ä¿¡æ¯ã€‚\n\nç›¸å…³æäº¤: ' + context.sha,
              labels: ['documentation', 'maintenance']
            });
